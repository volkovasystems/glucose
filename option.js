"use strict";

/*;
	@submodule-license:
		The MIT License (MIT)
		@mit-license

		Copyright (@c) 2017 Richeve Siodina Bebedor
		@email: richeve.bebedor@gmail.com

		Permission is hereby granted, free of charge, to any person obtaining a copy
		of this software and associated documentation files (the "Software"), to deal
		in the Software without restriction, including without limitation the rights
		to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
		copies of the Software, and to permit persons to whom the Software is
		furnished to do so, subject to the following conditions:

		The above copyright notice and this permission notice shall be included in all
		copies or substantial portions of the Software.

		THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
		IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
		FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
		AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
		LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
		OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
		SOFTWARE.
	@end-submodule-license

	@submodule-configuration:
		{
			"package": "glucose",
			"path": "glucose/option.js",
			"file": "option.js",
			"module": "glucose",
			"author": "Richeve S. Bebedor",
			"contributors": [
				"John Lenon Maghanoy <johnlenonmaghanoy@gmail.com>"
			],
			"eMail": "richeve.bebedor@gmail.com",
			"repository": "https://github.com/volkovasystems/glucose.git",
			"test": "glucose-test.js",
			"class": true,
			"global": false
		}
	@end-submodule-configuration

	@submodule-documentation:
		Option class.
	@end-submodule-documentation

	@include:
		{
			"clazof": "clazof",
			"diatom": "diatom",
			"falze": "falze",
			"falzy": "falzy",
			"harden": "harden",
			"protype": "protype",
			"stuffed": "stuffed",
			"transpher": "transpher",
			"truly": "truly",
			"truu": "truu"
		}
	@end-include
*/

var _getOwnPropertyNames = require("babel-runtime/core-js/object/get-own-property-names");

var _getOwnPropertyNames2 = _interopRequireDefault(_getOwnPropertyNames);

var _symbol = require("babel-runtime/core-js/symbol");

var _symbol2 = _interopRequireDefault(_symbol);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var clazof = require("clazof");
var diatom = require("diatom");
var falze = require("falze");
var falzy = require("falzy");
var harden = require("harden");
var proplist = require("proplist");
var protype = require("protype");
var stuffed = require("stuffed");
var transpher = require("transpher");
var truly = require("truly");
var truu = require("truu");

harden("COATED", (0, _symbol2.default)("coated"));

var Option = diatom("Option");

/*;
	@option;
		{
			"self": "object"
			"factor": Array,
			"identity": "object",
			"setting": "object",
			"query": "object",
			"pagination": "object",
			"data": "object",
			"list": Array,
			"element": "object",
			"array": "object",
			"scope": Array,
			"permission": Array
		}
	@end-option
*/
Option.prototype.initialize = function initialize(option) {
	/*;
 	@meta-configuration:
 		{
 			"option:required": "object"
 		}
 	@end-meta-configuration
 */
	if (option.COATED === COATED) {
		transpher(option, this);

		return this;
	}

	harden("COATED", COATED, this);

	harden("self", option.self, this);

	harden("cache", option.cache || {}, this);

	this.transfer(option);

	return this;
};

Option.prototype.get = function get(name) {
	/*;
 	@meta-configuration:
 		{
 			"name:required": "string"
 		}
 	@end-meta-configuration
 */

	if (falzy(name) || !protype(name, STRING)) {
		throw new Error("invalid name");
	}

	return this.cache[name];
};

Option.prototype.set = function set(name, value) {
	/*;
 	@meta-configuration:
 		{
 			"name:required": "string",
 			"value:required": "*"
 		}
 	@end-meta-configuration
 */

	if (falzy(name) || !protype(name, STRING)) {
		throw new Error("invalid name");
	}

	if (falzy(value)) {
		throw new Error("invalid value");
	}

	this.cache[name] = value;

	return this;
};

Option.prototype.clear = function clear(name) {
	/*;
 	@meta-configuration:
 		{
 			"name:required": "string"
 		}
 	@end-meta-configuration
 */

	if (truly(name) && !protype(name, STRING)) {
		throw new Error("invalid name");
	}

	if (truly(name)) {
		delete this.cache[name];
	} else {
		for (var property in this.cache) {
			delete this.cache[property];
		}
	}

	return this;
};

Option.prototype.mix = function mix(choice) {
	/*;
 	@meta-configuration:
 		{
 			"choice:required": Option
 		}
 	@end-meta-configuration
 */

	if (!clazof(choice, Option)) {
		choice = Option(choice);
	}

	if (truly(choice) && protype(choice, OBJECT) && clazof(choice, Option) && protype(choice.cache, OBJECT) && stuffed(choice.cache)) {
		for (var property in choice.cache) {
			this.cache[property] = choice.cache[property];
		}

		for (var _property in this.cache) {
			choice.cache[_property] = this.cache[_property];
		}
	}

	return this;
};

Option.prototype.transfer = function transfer(option) {
	/*;
 	@meta-configuration:
 		{
 			"option:required": Option
 		}
 	@end-meta-configuration
 */

	if (truly(option) && protype(option, OBJECT)) {
		/*;
  	These are standard conventional prooperties.
  */
		this.factor = truu(option.factor) ? option.factor : [];
		this.identity = truu(option.identity) ? option.identity : {};

		this.setting = truu(option.setting) ? option.setting : {};
		this.query = truu(option.query) ? option.query : {};
		this.pagination = truu(option.pagination) ? option.pagination : {};

		this.data = truu(option.data) ? option.data : {};
		this.list = truu(option.list) ? option.list : [];
		this.element = truu(option.element) ? option.element : {};
		this.array = truu(option.array) ? option.array : {};

		this.scope = truu(option.scope) ? option.scope : [];
		this.permission = truu(option.permission) ? option.permission : [];

		transpher(option, this);
	}

	return this;
};

Option.prototype.empty = function empty(property) {
	var _this = this;

	/*;
 	@meta-configuration:
 		{
 			"property:required": "string"
 		}
 	@end-meta-configuration
 */

	if (truly(property) && !protype(property, STRING)) {
		throw new Error("invalid property");
	}

	if (truly(property)) {
		return falze(this[property]);
	} else {
		return (0, _getOwnPropertyNames2.default)(this).filter(function (property) {
			return property != "self" && protype(_this[property], OBJECT, STRING, NUMBER, BOOLEAN, SYMBOL);
		}).every(function (property) {
			return falze(_this[property]);
		});
	}

	return this;
};

Option.prototype.toJSON = function toJSON() {
	var object = {};

	proplist(this).filter(function (property) {
		return property.enumerable;
	}).forEach(function (_ref) {
		var property = _ref.property,
		    value = _ref.value;

		object[property] = value;
	});

	return object;
};

module.exports = Option;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm9wdGlvbi5tb2R1bGUuanMiXSwibmFtZXMiOlsiY2xhem9mIiwicmVxdWlyZSIsImRpYXRvbSIsImZhbHplIiwiZmFsenkiLCJoYXJkZW4iLCJwcm9wbGlzdCIsInByb3R5cGUiLCJzdHVmZmVkIiwidHJhbnNwaGVyIiwidHJ1bHkiLCJ0cnV1IiwiT3B0aW9uIiwicHJvdG90eXBlIiwiaW5pdGlhbGl6ZSIsIm9wdGlvbiIsIkNPQVRFRCIsInNlbGYiLCJjYWNoZSIsInRyYW5zZmVyIiwiZ2V0IiwibmFtZSIsIlNUUklORyIsIkVycm9yIiwic2V0IiwidmFsdWUiLCJjbGVhciIsInByb3BlcnR5IiwibWl4IiwiY2hvaWNlIiwiT0JKRUNUIiwiZmFjdG9yIiwiaWRlbnRpdHkiLCJzZXR0aW5nIiwicXVlcnkiLCJwYWdpbmF0aW9uIiwiZGF0YSIsImxpc3QiLCJlbGVtZW50IiwiYXJyYXkiLCJzY29wZSIsInBlcm1pc3Npb24iLCJlbXB0eSIsImZpbHRlciIsIk5VTUJFUiIsIkJPT0xFQU4iLCJTWU1CT0wiLCJldmVyeSIsInRvSlNPTiIsIm9iamVjdCIsImVudW1lcmFibGUiLCJmb3JFYWNoIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6IkFBQUE7O0FBRUE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQWlFQSxJQUFNQSxTQUFTQyxRQUFTLFFBQVQsQ0FBZjtBQUNBLElBQU1DLFNBQVNELFFBQVMsUUFBVCxDQUFmO0FBQ0EsSUFBTUUsUUFBUUYsUUFBUyxPQUFULENBQWQ7QUFDQSxJQUFNRyxRQUFRSCxRQUFTLE9BQVQsQ0FBZDtBQUNBLElBQU1JLFNBQVNKLFFBQVMsUUFBVCxDQUFmO0FBQ0EsSUFBTUssV0FBV0wsUUFBUyxVQUFULENBQWpCO0FBQ0EsSUFBTU0sVUFBVU4sUUFBUyxTQUFULENBQWhCO0FBQ0EsSUFBTU8sVUFBVVAsUUFBUyxTQUFULENB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UUFBTixDQUFULEVBQTJCRyxNQUEzQixFQUFtQ1IsTUFBbkMsRUFBMkNzQixNQUEzQyxFQUFtREMsT0FBbkQsRUFBNERDLE1BQTVELENBREQ7QUFFQSxHQUpLLEVBS0xDLEtBTEssQ0FLRSxVQUFFcEIsUUFBRixFQUFnQjtBQUFFLFVBQU94QixNQUFPLE1BQU13QixRQUFOLENBQVAsQ0FBUDtBQUFtQyxHQUx2RCxDQUFQO0FBTUE7O0FBRUQsUUFBTyxJQUFQO0FBQ0EsQ0ExQkQ7O0FBNEJBZixPQUFPQyxTQUFQLENBQWlCbUMsTUFBakIsR0FBMEIsU0FBU0EsTUFBVCxHQUFrQjtBQUMzQyxLQUFJQyxTQUFTLEVBQWI7O0FBRUEzQyxVQUFVLElBQVYsRUFDRXFDLE1BREYsQ0FDVSxVQUFFaEIsUUFBRixFQUFnQjtBQUFFLFNBQU9BLFNBQVN1QixVQUFoQjtBQUE2QixFQUR6RCxFQUVFQyxPQUZGLENBRVcsZ0JBQTJCO0FBQUEsTUFBdkJ4QixRQUF1QixRQUF2QkEsUUFBdUI7QUFBQSxNQUFiRixLQUFhLFFBQWJBLEtBQWE7O0FBQ3BDd0IsU0FBUXRCLFFBQVIsSUFBcUJGLEtBQXJCO0FBQ0EsRUFKRjs7QUFNQSxRQUFPd0IsTUFBUDtBQUNBLENBVkQ7O0FBWUFHLE9BQU9DLE9BQVAsR0FBaUJ6QyxNQUFqQiIsImZpbGUiOiJvcHRpb24ubW9kdWxlLmpzIiwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5cbi8qO1xuXHRAc3VibW9kdWxlLWxpY2Vuc2U6XG5cdFx0VGhlIE1JVCBMaWNlbnNlIChNSVQpXG5cdFx0QG1pdC1saWNlbnNlXG5cblx0XHRDb3B5cmlnaHQgKEBjKSAyMDE3IFJpY2hldmUgU2lvZGluYSBCZWJlZG9yXG5cdFx0QGVtYWlsOiByaWNoZXZlLmJlYmVkb3JAZ21haWwuY29tXG5cblx0XHRQZXJtaXNzaW9uIGlzIGhlcmVieSBncmFudGVkLCBmcmVlIG9mIGNoYXJnZSwgdG8gYW55IHBlcnNvbiBvYnRhaW5pbmcgYSBjb3B5XG5cdFx0b2YgdGhpcyBzb2Z0d2FyZSBhbmQgYXNzb2NpYXRlZCBkb2N1bWVudGF0aW9uIGZpbGVzICh0aGUgXCJTb2Z0d2FyZVwiKSwgdG8gZGVhbFxuXHRcdGluIHRoZSBTb2Z0d2FyZSB3aXRob3V0IHJlc3RyaWN0aW9uLCBpbmNsdWRpbmcgd2l0aG91dCBsaW1pdGF0aW9uIHRoZSByaWdodHNcblx0XHR0byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsIHB1Ymxpc2gsIGRpc3RyaWJ1dGUsIHN1YmxpY2Vuc2UsIGFuZC9vciBzZWxsXG5cdFx0Y29waWVzIG9mIHRoZSBTb2Z0d2FyZSwgYW5kIHRvIHBlcm1pdCBwZXJzb25zIHRvIHdob20gdGhlIFNvZnR3YXJlIGlzXG5cdFx0ZnVybmlzaGVkIHRvIGRvIHNvLCBzdWJqZWN0IHRvIHRoZSBmb2xsb3dpbmcgY29uZGl0aW9uczpcblxuXHRcdFRoZSBhYm92ZSBjb3B5cmlnaHQgbm90aWNlIGFuZCB0aGlzIHBlcm1pc3Npb24gbm90aWNlIHNoYWxsIGJlIGluY2x1ZGVkIGluIGFsbFxuXHRcdGNvcGllcyBvciBzdWJzdGFudGlhbCBwb3J0aW9ucyBvZiB0aGUgU29mdHdhcmUuXG5cblx0XHRUSEUgU09GVFdBUkUgSVMgUFJPVklERUQgXCJBUyBJU1wiLCBXSVRIT1VUIFdBUlJBTlRZIE9GIEFOWSBLSU5ELCBFWFBSRVNTIE9SXG5cdFx0SU1QTElFRCwgSU5DTFVESU5HIEJVVCBOT1QgTElNSVRFRCBUTyBUSEUgV0FSUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFksXG5cdFx0RklUTkVTUyBGT1IgQSBQQVJUSUNVTEFSIFBVUlBPU0UgQU5EIE5PTklORlJJTkdFTUVOVC4gSU4gTk8gRVZFTlQgU0hBTEwgVEhFXG5cdFx0QVVUSE9SUyBPUiBDT1BZUklHSFQgSE9MREVSUyBCRSBMSUFCTEUgRk9SIEFOWSBDTEFJTSwgREFNQUdFUyBPUiBPVEhFUlxuXHRcdExJQUJJTElUWSwgV0hFVEhFUiBJTiBBTiBBQ1RJT04gT0YgQ09OVFJBQ1QsIFRPUlQgT1IgT1RIRVJXSVNFLCBBUklTSU5HIEZST00sXG5cdFx0T1VUIE9GIE9SIElOIENPTk5FQ1RJT04gV0lUSCBUSEUgU09GVFdBUkUgT1IgVEhFIFVTRSBPUiBPVEhFUiBERUFMSU5HUyBJTiBUSEVcblx0XHRTT0ZUV0FSRS5cblx0QGVuZC1zdWJtb2R1bGUtbGljZW5zZVxuXG5cdEBzdWJtb2R1bGUtY29uZmlndXJhdGlvbjpcblx0XHR7XG5cdFx0XHRcInBhY2thZ2VcIjogXCJnbHVjb3NlXCIsXG5cdFx0XHRcInBhdGhcIjogXCJnbHVjb3NlL29wdGlvbi5qc1wiLFxuXHRcdFx0XCJmaWxlXCI6IFwib3B0aW9uLmpzXCIsXG5cdFx0XHRcIm1vZHVsZVwiOiBcImdsdWNvc2VcIixcblx0XHRcdFwiYXV0aG9yXCI6IFwiUmljaGV2ZSBTLiBCZWJlZG9yXCIsXG5cdFx0XHRcImNvbnRyaWJ1dG9yc1wiOiBbXG5cdFx0XHRcdFwiSm9obiBMZW5vbiBNYWdoYW5veSA8am9obmxlbm9ubWFnaGFub3lAZ21haWwuY29tPlwiXG5cdFx0XHRdLFxuXHRcdFx0XCJlTWFpbFwiOiBcInJpY2hldmUuYmViZWRvckBnbWFpbC5jb21cIixcblx0XHRcdFwicmVwb3NpdG9yeVwiOiBcImh0dHBzOi8vZ2l0aHViLmNvbS92b2xrb3Zhc3lzdGVtcy9nbHVjb3NlLmdpdFwiLFxuXHRcdFx0XCJ0ZXN0XCI6IFwiZ2x1Y29zZS10ZXN0LmpzXCIsXG5cdFx0XHRcImNsYXNzXCI6IHRydWUsXG5cdFx0XHRcImdsb2JhbFwiOiBmYWxzZVxuXHRcdH1cblx0QGVuZC1zdWJtb2R1bGUtY29uZmlndXJhdGlvblxuXG5cdEBzdWJtb2R1bGUtZG9jdW1lbnRhdGlvbjpcblx0XHRPcHRpb24gY2xhc3MuXG5cdEBlbmQtc3VibW9kdWxlLWRvY3VtZW50YXRpb25cblxuXHRAaW5jbHVkZTpcblx0XHR7XG5cdFx0XHRcImNsYXpvZlwiOiBcImNsYXpvZlwiLFxuXHRcdFx0XCJkaWF0b21cIjogXCJkaWF0b21cIixcblx0XHRcdFwiZmFsemVcIjogXCJmYWx6ZVwiLFxuXHRcdFx0XCJmYWx6eVwiOiBcImZhbHp5XCIsXG5cdFx0XHRcImhhcmRlblwiOiBcImhhcmRlblwiLFxuXHRcdFx0XCJwcm90eXBlXCI6IFwicHJvdHlwZVwiLFxuXHRcdFx0XCJzdHVmZmVkXCI6IFwic3R1ZmZlZFwiLFxuXHRcdFx0XCJ0cmFuc3BoZXJcIjogXCJ0cmFuc3BoZXJcIixcblx0XHRcdFwidHJ1bHlcIjogXCJ0cnVseVwiLFxuXHRcdFx0XCJ0cnV1XCI6IFwidHJ1dVwiXG5cdFx0fVxuXHRAZW5kLWluY2x1ZGVcbiovXG5cbmNvbnN0IGNsYXpvZiA9IHJlcXVpcmUoIFwiY2xhem9mXCIgKTtcbmNvbnN0IGRpYXRvbSA9IHJlcXVpcmUoIFwiZGlhdG9tXCIgKTtcbmNvbnN0IGZhbHplID0gcmVxdWlyZSggXCJmYWx6ZVwiICk7XG5jb25zdCBmYWx6eSA9IHJlcXVpcmUoIFwiZmFsenlcIiApO1xuY29uc3QgaGFyZGVuID0gcmVxdWlyZSggXCJoYXJkZW5cIiApO1xuY29uc3QgcHJvcGxpc3QgPSByZXF1aXJlKCBcInByb3BsaXN0XCIgKTtcbmNvbnN0IHByb3R5cGUgPSByZXF1aXJlKCBcInByb3R5cGVcIiApO1xuY29uc3Qgc3R1ZmZlZCA9IHJlcXVpcmUoIFwic3R1ZmZlZFwiICk7XG5jb25zdCB0cmFuc3BoZXIgPSByZXF1aXJlKCBcInRyYW5zcGhlclwiICk7XG5jb25zdCB0cnVseSA9IHJlcXVpcmUoIFwidHJ1bHlcIiApO1xuY29uc3QgdHJ1dSA9IHJlcXVpcmUoIFwidHJ1dVwiICk7XG5cbmhhcmRlbiggXCJDT0FURURcIiwgU3ltYm9sKCBcImNvYXRlZFwiICkgKTtcblxuY29uc3QgT3B0aW9uID0gZGlhdG9tKCBcIk9wdGlvblwiICk7XG5cbi8qO1xuXHRAb3B0aW9uO1xuXHRcdHtcblx0XHRcdFwic2VsZlwiOiBcIm9iamVjdFwiXG5cdFx0XHRcImZhY3RvclwiOiBBcnJheSxcblx0XHRcdFwiaWRlbnRpdHlcIjogXCJvYmplY3RcIixcblx0XHRcdFwic2V0dGluZ1wiOiBcIm9iamVjdFwiLFxuXHRcdFx0XCJxdWVyeVwiOiBcIm9iamVjdFwiLFxuXHRcdFx0XCJwYWdpbmF0aW9uXCI6IFwib2JqZWN0XCIsXG5cdFx0XHRcImRhdGFcIjogXCJvYmplY3RcIixcblx0XHRcdFwibGlzdFwiOiBBcnJheSxcblx0XHRcdFwiZWxlbWVudFwiOiBcIm9iamVjdFwiLFxuXHRcdFx0XCJhcnJheVwiOiBcIm9iamVjdFwiLFxuXHRcdFx0XCJzY29wZVwiOiBBcnJheSxcblx0XHRcdFwicGVybWlzc2lvblwiOiBBcnJheVxuXHRcdH1cblx0QGVuZC1vcHRpb25cbiovXG5PcHRpb24ucHJvdG90eXBlLmluaXRpYWxpemUgPSBmdW5jdGlvbiBpbml0aWFsaXplKCBvcHRpb24gKXtcblx0Lyo7XG5cdFx0QG1ldGEtY29uZmlndXJhdGlvbjpcblx0XHRcdHtcblx0XHRcdFx0XCJvcHRpb246cmVxdWlyZWRcIjogXCJvYmplY3RcIlxuXHRcdFx0fVxuXHRcdEBlbmQtbWV0YS1jb25maWd1cmF0aW9uXG5cdCovXG5cdGlmKCBvcHRpb24uQ09BVEVEID09PSBDT0FURUQgKXtcblx0XHR0cmFuc3BoZXIoIG9wdGlvbiwgdGhpcyApO1xuXG5cdFx0cmV0dXJuIHRoaXM7XG5cdH1cblxuXHRoYXJkZW4oIFwiQ09BVEVEXCIsIENPQVRFRCwgdGhpcyApO1xuXG5cdGhhcmRlbiggXCJzZWxmXCIsIG9wdGlvbi5zZWxmLCB0aGlzICk7XG5cblx0aGFyZGVuKCBcImNhY2hlXCIsIG9wdGlvbi5jYWNoZSB8fCB7IH0sIHRoaXMgKTtcblxuXHR0aGlzLnRyYW5zZmVyKCBvcHRpb24gKTtcblxuXHRyZXR1cm4gdGhpcztcbn07XG5cbk9wdGlvbi5wcm90b3R5cGUuZ2V0ID0gZnVuY3Rpb24gZ2V0KCBuYW1lICl7XG5cdC8qO1xuXHRcdEBtZXRhLWNvbmZpZ3VyYXRpb246XG5cdFx0XHR7XG5cdFx0XHRcdFwibmFtZTpyZXF1aXJlZFwiOiBcInN0cmluZ1wiXG5cdFx0XHR9XG5cdFx0QGVuZC1tZXRhLWNvbmZpZ3VyYXRpb25cblx0Ki9cblxuXHRpZiggZmFsenkoIG5hbWUgKSB8fCAhcHJvdHlwZSggbmFtZSwgU1RSSU5HICkgKXtcblx0XHR0aHJvdyBuZXcgRXJyb3IoIFwiaW52YWxpZCBuYW1lXCIgKTtcblx0fVxuXG5cdHJldHVybiB0aGlzLmNhY2hlWyBuYW1lIF07XG59O1xuXG5PcHRpb24ucHJvdG90eXBlLnNldCA9IGZ1bmN0aW9uIHNldCggbmFtZSwgdmFsdWUgKXtcblx0Lyo7XG5cdFx0QG1ldGEtY29uZmlndXJhdGlvbjpcblx0XHRcdHtcblx0XHRcdFx0XCJuYW1lOnJlcXVpcmVkXCI6IFwic3RyaW5nXCIsXG5cdFx0XHRcdFwidmFsdWU6cmVxdWlyZWRcIjogXCIqXCJcblx0XHRcdH1cblx0XHRAZW5kLW1ldGEtY29uZmlndXJhdGlvblxuXHQqL1xuXG5cdGlmKCBmYWx6eSggbmFtZSApIHx8ICFwcm90eXBlKCBuYW1lLCBTVFJJTkcgKSApe1xuXHRcdHRocm93IG5ldyBFcnJvciggXCJpbnZhbGlkIG5hbWVcIiApO1xuXHR9XG5cblx0aWYoIGZhbHp5KCB2YWx1ZSApICl7XG5cdFx0dGhyb3cgbmV3IEVycm9yKCBcImludmFsaWQgdmFsdWVcIiApO1xuXHR9XG5cblx0dGhpcy5jYWNoZVsgbmFtZSBdID0gdmFsdWU7XG5cblx0cmV0dXJuIHRoaXM7XG59O1xuXG5PcHRpb24ucHJvdG90eXBlLmNsZWFyID0gZnVuY3Rpb24gY2xlYXIoIG5hbWUgKXtcblx0Lyo7XG5cdFx0QG1ldGEtY29uZmlndXJhdGlvbjpcblx0XHRcdHtcblx0XHRcdFx0XCJuYW1lOnJlcXVpcmVkXCI6IFwic3RyaW5nXCJcblx0XHRcdH1cblx0XHRAZW5kLW1ldGEtY29uZmlndXJhdGlvblxuXHQqL1xuXG5cdGlmKCB0cnVseSggbmFtZSApICYmICFwcm90eXBlKCBuYW1lLCBTVFJJTkcgKSApe1xuXHRcdHRocm93IG5ldyBFcnJvciggXCJpbnZhbGlkIG5hbWVcIiApO1xuXHR9XG5cblx0aWYoIHRydWx5KCBuYW1lICkgKXtcblx0XHRkZWxldGUgdGhpcy5jYWNoZVsgbmFtZSBdO1xuXG5cdH1lbHNle1xuXHRcdGZvciggbGV0IHByb3BlcnR5IGluIHRoaXMuY2FjaGUgKXtcblx0XHRcdGRlbGV0ZSB0aGlzLmNhY2hlWyBwcm9wZXJ0eSBdO1xuXHRcdH1cblx0fVxuXG5cdHJldHVybiB0aGlzO1xufTtcblxuT3B0aW9uLnByb3RvdHlwZS5taXggPSBmdW5jdGlvbiBtaXgoIGNob2ljZSApe1xuXHQvKjtcblx0XHRAbWV0YS1jb25maWd1cmF0aW9uOlxuXHRcdFx0e1xuXHRcdFx0XHRcImNob2ljZTpyZXF1aXJlZFwiOiBPcHRpb25cblx0XHRcdH1cblx0XHRAZW5kLW1ldGEtY29uZmlndXJhdGlvblxuXHQqL1xuXG5cdGlmKCAhY2xhem9mKCBjaG9pY2UsIE9wdGlvbiApICl7XG5cdFx0Y2hvaWNlID0gT3B0aW9uKCBjaG9pY2UgKTtcblx0fVxuXG5cdGlmKCB0cnVseSggY2hvaWNlICkgJiZcblx0XHRwcm90eXBlKCBjaG9pY2UsIE9CSkVDVCApICYmXG5cdFx0Y2xhem9mKCBjaG9pY2UsIE9wdGlvbiApICYmXG5cdFx0cHJvdHlwZSggY2hvaWNlLmNhY2hlLCBPQkpFQ1QgKSAmJlxuXHRcdHN0dWZmZWQoIGNob2ljZS5jYWNoZSApIClcblx0e1xuXHRcdGZvciggbGV0IHByb3BlcnR5IGluIGNob2ljZS5jYWNoZSApe1xuXHRcdFx0dGhpcy5jYWNoZVsgcHJvcGVydHkgXSA9IGNob2ljZS5jYWNoZVsgcHJvcGVydHkgXTtcblx0XHR9XG5cblx0XHRmb3IoIGxldCBwcm9wZXJ0eSAgaW4gdGhpcy5jYWNoZSApe1xuXHRcdFx0Y2hvaWNlLmNhY2hlWyBwcm9wZXJ0eSBdID0gdGhpcy5jYWNoZVsgcHJvcGVydHkgXTtcblx0XHR9XG5cdH1cblxuXHRyZXR1cm4gdGhpcztcbn07XG5cbk9wdGlvbi5wcm90b3R5cGUudHJhbnNmZXIgPSBmdW5jdGlvbiB0cmFuc2Zlciggb3B0aW9uICl7XG5cdC8qO1xuXHRcdEBtZXRhLWNvbmZpZ3VyYXRpb246XG5cdFx0XHR7XG5cdFx0XHRcdFwib3B0aW9uOnJlcXVpcmVkXCI6IE9wdGlvblxuXHRcdFx0fVxuXHRcdEBlbmQtbWV0YS1jb25maWd1cmF0aW9uXG5cdCovXG5cblx0aWYoIHRydWx5KCBvcHRpb24gKSAmJiBwcm90eXBlKCBvcHRpb24sIE9CSkVDVCApICl7XG5cdFx0Lyo7XG5cdFx0XHRUaGVzZSBhcmUgc3RhbmRhcmQgY29udmVudGlvbmFsIHByb29wZXJ0aWVzLlxuXHRcdCovXG5cdFx0dGhpcy5mYWN0b3IgPSB0cnV1KCBvcHRpb24uZmFjdG9yICk/IG9wdGlvbi5mYWN0b3IgOiBbIF07XG5cdFx0dGhpcy5pZGVudGl0eSA9IHRydXUoIG9wdGlvbi5pZGVudGl0eSApPyBvcHRpb24uaWRlbnRpdHkgOiB7IH07XG5cblx0XHR0aGlzLnNldHRpbmcgPSB0cnV1KCBvcHRpb24uc2V0dGluZyApPyBvcHRpb24uc2V0dGluZyA6IHsgfTtcblx0XHR0aGlzLnF1ZXJ5ID0gdHJ1dSggb3B0aW9uLnF1ZXJ5ICk/IG9wdGlvbi5xdWVyeSA6IHsgfTtcblx0XHR0aGlzLnBhZ2luYXRpb24gPSB0cnV1KCBvcHRpb24ucGFnaW5hdGlvbiApPyBvcHRpb24ucGFnaW5hdGlvbiA6IHsgfTtcblxuXHRcdHRoaXMuZGF0YSA9IHRydXUoIG9wdGlvbi5kYXRhICk/IG9wdGlvbi5kYXRhIDogeyB9O1xuXHRcdHRoaXMubGlzdCA9IHRydXUoIG9wdGlvbi5saXN0ICk/IG9wdGlvbi5saXN0IDogWyBdO1xuXHRcdHRoaXMuZWxlbWVudCA9IHRydXUoIG9wdGlvbi5lbGVtZW50ICk/IG9wdGlvbi5lbGVtZW50IDogeyB9O1xuXHRcdHRoaXMuYXJyYXkgPSB0cnV1KCBvcHRpb24uYXJyYXkgKT8gb3B0aW9uLmFycmF5IDogeyB9O1xuXG5cdFx0dGhpcy5zY29wZSA9IHRydXUoIG9wdGlvbi5zY29wZSApPyBvcHRpb24uc2NvcGUgOiBbIF07XG5cdFx0dGhpcy5wZXJtaXNzaW9uID0gdHJ1dSggb3B0aW9uLnBlcm1pc3Npb24gKT8gb3B0aW9uLnBlcm1pc3Npb24gOiBbIF07XG5cblx0XHR0cmFuc3BoZXIoIG9wdGlvbiwgdGhpcyApO1xuXHR9XG5cblx0cmV0dXJuIHRoaXM7XG59O1xuXG5PcHRpb24ucHJvdG90eXBlLmVtcHR5ID0gZnVuY3Rpb24gZW1wdHkoIHByb3BlcnR5ICl7XG5cdC8qO1xuXHRcdEBtZXRhLWNvbmZpZ3VyYXRpb246XG5cdFx0XHR7XG5cdFx0XHRcdFwicHJvcGVydHk6cmVxdWlyZWRcIjogXCJzdHJpbmdcIlxuXHRcdFx0fVxuXHRcdEBlbmQtbWV0YS1jb25maWd1cmF0aW9uXG5cdCovXG5cblx0aWYoIHRydWx5KCBwcm9wZXJ0eSApICYmICFwcm90eXBlKCBwcm9wZXJ0eSwgU1RSSU5HICkgKXtcblx0XHR0aHJvdyBuZXcgRXJyb3IoIFwiaW52YWxpZCBwcm9wZXJ0eVwiICk7XG5cdH1cblxuXHRpZiggdHJ1bHkoIHByb3BlcnR5ICkgKXtcblx0XHRyZXR1cm4gZmFsemUoIHRoaXNbIHByb3BlcnR5IF0gKTtcblxuXHR9ZWxzZXtcblx0XHRyZXR1cm4gT2JqZWN0LmdldE93blByb3BlcnR5TmFtZXMoIHRoaXMgKVxuXHRcdFx0LmZpbHRlciggKCBwcm9wZXJ0eSApID0+IHtcblx0XHRcdFx0cmV0dXJuICggcHJvcGVydHkgIT0gXCJzZWxmXCIgJiZcblx0XHRcdFx0XHRwcm90eXBlKCB0aGlzWyBwcm9wZXJ0eSBdLCBPQkpFQ1QsIFNUUklORywgTlVNQkVSLCBCT09MRUFOLCBTWU1CT0wgKSApO1xuXHRcdFx0fSApXG5cdFx0XHQuZXZlcnkoICggcHJvcGVydHkgKSA9PiB7IHJldHVybiBmYWx6ZSggdGhpc1sgcHJvcGVydHkgXSApOyB9ICk7XG5cdH1cblxuXHRyZXR1cm4gdGhpcztcbn07XG5cbk9wdGlvbi5wcm90b3R5cGUudG9KU09OID0gZnVuY3Rpb24gdG9KU09OKCApe1xuXHRsZXQgb2JqZWN0ID0geyB9O1xuXG5cdHByb3BsaXN0KCB0aGlzIClcblx0XHQuZmlsdGVyKCAoIHByb3BlcnR5ICkgPT4geyByZXR1cm4gcHJvcGVydHkuZW51bWVyYWJsZTsgfSApXG5cdFx0LmZvckVhY2goICggeyBwcm9wZXJ0eSwgdmFsdWUgfSApID0+IHtcblx0XHRcdG9iamVjdFsgcHJvcGVydHkgXSA9IHZhbHVlO1xuXHRcdH0gKTtcblxuXHRyZXR1cm4gb2JqZWN0O1xufTtcblxubW9kdWxlLmV4cG9ydHMgPSBPcHRpb247XG4iXX0=
